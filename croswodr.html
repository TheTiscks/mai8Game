<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Премиум Сканворд</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --text-color: #333;
            --light-bg: #f5f7fa;
            --cell-size: 35px;
            --correct-color: #4CAF50;
            --incorrect-color: #f44336;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
        }

        h1 {
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 500;
        }

        /* Стили авторизации */
        #auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh;
        }

        .auth-form {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .auth-form input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .auth-form button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .auth-form button:hover {
            background: var(--secondary-color);
        }

        /* Стили сканворда */
        #crossword-container {
            display: none;
        }

        .crossword-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        #logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #logout-btn:hover {
            background: #c0392b;
        }

        .crossword-wrapper {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        #crossword {
            display: grid;
            grid-template-columns: repeat(20, var(--cell-size));
            grid-template-rows: repeat(20, var(--cell-size));
            gap: 2px;
            margin: 0 auto;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            position: relative;
            font-weight: bold;
            transition: all 0.2s;
        }

        .cell:hover {
            transform: scale(1.05);
            z-index: 1;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 18px;
            text-transform: uppercase;
            background: transparent;
            font-weight: bold;
        }

        .cell input:focus {
            outline: none;
            background-color: rgba(74, 111, 165, 0.1);
        }

        .cell.black {
            background-color: #2c3e50;
            border-color: #2c3e50;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            color: var(--primary-color);
        }

        .clues-panel {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .clues-section {
            margin-bottom: 20px;
        }

        .clues-section h3 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        .clue {
            margin-bottom: 8px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .clue:hover {
            background: rgba(74, 111, 165, 0.1);
        }

        .clue-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 5px;
        }

        .active-clue {
            background: rgba(74, 111, 165, 0.2);
            font-weight: 500;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .control-btn {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .control-btn:hover {
            background: var(--secondary-color);
        }

        #reveal-btn {
            background: #FF9800;
        }

        #reveal-btn:hover {
            background: #F57C00;
        }

        #new-game-btn {
            background: #9C27B0;
        }

        #new-game-btn:hover {
            background: #7B1FA2;
        }

        .timer {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary-color);
            margin-left: auto;
        }

        .correct {
            color: var(--correct-color);
        }

        .incorrect {
            color: var(--incorrect-color);
            background-color: rgba(244, 67, 54, 0.1);
        }

        .word-correct {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .word-incorrect {
            background-color: rgba(244, 67, 54, 0.1);
        }

        @media (max-width: 768px) {
            :root {
                --cell-size: 30px;
            }

            .crossword-wrapper {
                flex-direction: column;
            }

            #crossword {
                grid-template-columns: repeat(15, var(--cell-size));
                grid-template-rows: repeat(15, var(--cell-size));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="auth-container">
            <div class="auth-form">
                <h1>Добро пожаловать!</h1>
                <p>Введите ваш email для доступа к премиум сканворду</p>
                <form id="auth-form">
                    <input type="email" id="email" placeholder="Ваш email" required>
                    <button type="submit">Начать решение</button>
                </form>
            </div>
        </div>

        <div id="crossword-container">
            <div class="crossword-header">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <span id="user-email"></span>
                </div>
                <div class="timer" id="timer">00:00:00</div>
                <button id="logout-btn">Выйти</button>
            </div>

            <div class="crossword-wrapper">
                <div id="crossword"></div>

                <div class="clues-panel">
                    <div class="clues-section">
                        <h3>По горизонтали:</h3>
                        <div id="across-clues"></div>
                    </div>
                    <div class="clues-section">
                        <h3>По вертикали:</h3>
                        <div id="down-clues"></div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" id="reveal-btn">Показать ответ</button>
                <button class="control-btn" id="new-game-btn">Новая игра</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Глобальные переменные
            let words = [];
            let timerInterval;
            let seconds = 0;
            let currentCrossword = null;

            // Проверка авторизации
            const userEmail = localStorage.getItem('crosswordUserEmail');
            if (userEmail) {
                showCrossword(userEmail);
            }

            // Обработка формы авторизации
            $('#auth-form').submit(function(e) {
                e.preventDefault();
                const email = $('#email').val().trim();

                if (email) {
                    localStorage.setItem('crosswordUserEmail', email);
                    showCrossword(email);
                }
            });

            // Выход из системы
            $('#logout-btn').click(function() {
                localStorage.removeItem('crosswordUserEmail');
                location.reload();
            });

            // Функция показа сканворда
            function showCrossword(email) {
                $('#auth-container').hide();
                $('#crossword-container').show();
                $('#user-email').text(email);
                $('#user-avatar').text(email.charAt(0).toUpperCase());

                startTimer();
                generateCrossword();
            }

            // Таймер
            function startTimer() {
                clearInterval(timerInterval);
                seconds = 0;
                updateTimerDisplay();
                timerInterval = setInterval(function() {
                    seconds++;
                    updateTimerDisplay();
                }, 1000);
            }

            function updateTimerDisplay() {
                const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                $('#timer').text(`${hours}:${minutes}:${secs}`);
            }

            // Генерация сканворда
            function generateCrossword() {
                currentCrossword = {
                    grid: [],
                    words: []
                };

                const crossword = $('#crossword');
                crossword.empty();

                // Размер сетки
                const rows = 20;
                const cols = 20;

                // Список слов для сканворда
                words = [
                    // По горизонтали
                    { word: "ПРОГРАММИРОВАНИЕ", clue: "Процесс создания компьютерных программ", row: 1, col: 3, direction: "across" },
                    { word: "АЛГОРИТМ", clue: "Последовательность действий для решения задачи", row: 3, col: 5, direction: "across" },
                    { word: "КОМПИЛЯТОР", clue: "Программа, переводящая код в машинный язык", row: 5, col: 2, direction: "across" },
                    { word: "ФУНКЦИЯ", clue: "Подпрограмма, выполняющая определенную задачу", row: 7, col: 8, direction: "across" },
                    { word: "БАЗАДАННЫХ", clue: "Структурированный набор данных", row: 9, col: 6, direction: "across" },
                    { word: "ИНТЕРФЕЙС", clue: "Средство взаимодействия между системами", row: 11, col: 4, direction: "across" },
                    { word: "СЕРВЕР", clue: "Компьютер, предоставляющий услуги другим компьютерам", row: 13, col: 7, direction: "across" },

                    // По вертикали
                    { word: "ПИТОН", clue: "Популярный язык программирования", row: 2, col: 4, direction: "down" },
                    { word: "ЖАВАСКРИПТ", clue: "Язык для веб-разработки", row: 1, col: 10, direction: "down" },
                    { word: "СИНТАКСИС", clue: "Правила написания кода", row: 2, col: 15, direction: "down" },
                    { word: "ОБЪЕКТ", clue: "Экземпляр класса в ООП", row: 4, col: 12, direction: "down" },
                    { word: "ЦИКЛ", clue: "Конструкция для повторения действий", row: 6, col: 9, direction: "down" },
                    { word: "МАССИВ", clue: "Структура данных для хранения элементов", row: 8, col: 6, direction: "down" },
                    { word: "КОД", clue: "Набор инструкций для компьютера", row: 10, col: 3, direction: "down" }
                ];

                currentCrossword.words = words;

                // Создаем сетку
                for (let row = 0; row < rows; row++) {
                    currentCrossword.grid[row] = [];
                    for (let col = 0; col < cols; col++) {
                        const cell = $('<div>').addClass('cell');
                        crossword.append(cell);
                        currentCrossword.grid[row][col] = {
                            element: cell,
                            isBlack: false,
                            words: []
                        };
                    }
                }

                // Размещаем слова
                let wordNumber = 1;
                const acrossClues = $('#across-clues');
                const downClues = $('#down-clues');
                acrossClues.empty();
                downClues.empty();

                words.forEach(wordObj => {
                    const { word, clue, row, col, direction } = wordObj;
                    const wordLength = word.length;

                    // Добавляем подсказку
                    const clueElement = $('<div>')
                        .addClass('clue')
                        .attr('data-word', `${direction}-${wordNumber}`)
                        .html(`<span class="clue-number">${wordNumber}.</span> ${clue}`)
                        .click(function() {
                            highlightWord(wordObj);
                        });

                    if (direction === "across") {
                        acrossClues.append(clueElement);
                    } else {
                        downClues.append(clueElement);
                    }

                    // Размещаем слово в сетке
                    for (let i = 0; i < wordLength; i++) {
                        const currentRow = direction === "down" ? row + i - 1 : row - 1;
                        const currentCol = direction === "across" ? col + i - 1 : col - 1;

                        const cellData = currentCrossword.grid[currentRow][currentCol];
                        cellData.isBlack = false;

                        // Добавляем номер слова
                        if (i === 0) {
                            cellData.element.append($('<span>').addClass('cell-number').text(wordNumber));
                        }

                        // Создаем input для буквы
                        if (!cellData.element.children('input').length) {
                            const input = $('<input>')
                                .attr('type', 'text')
                                .attr('maxlength', '1')
                                .attr('data-row', currentRow)
                                .attr('data-col', currentCol)
                                .attr('data-word', `${direction}-${wordNumber}`)
                                .attr('data-position', i);
                            cellData.element.append(input);
                        }

                        // Добавляем информацию о слове в ячейку
                        cellData.words.push({
                            wordObj,
                            position: i,
                            wordNumber
                        });
                    }

                    wordNumber++;
                });

                // Заполняем остальные клетки как черные
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        if (currentCrossword.grid[row][col].words.length === 0) {
                            currentCrossword.grid[row][col].isBlack = true;
                            currentCrossword.grid[row][col].element.addClass('black');
                        }
                    }
                }

                // Навигация по сканворду
                $('.cell input').on('input', function() {
                    const direction = $(this).data('word').split('-')[0];
                    const wordNum = $(this).data('word').split('-')[1];
                    const row = parseInt($(this).data('row'));
                    const col = parseInt($(this).data('col'));

                    // Автопереход к следующей ячейке
                    const nextCell = getNextCell(row, col, direction);
                    if (nextCell) {
                        nextCell.focus();
                    }

                    // Проверка слова при полном вводе
                    checkWordOnComplete($(this));
                });

                // Подсветка слова при клике на ячейку
                $('.cell input').on('click', function() {
                    const wordId = $(this).data('word');
                    if (wordId) {
                        const wordObj = words.find(w =>
                            `${w.direction}-${words.indexOf(w) + 1}` === wordId
                        );
                        if (wordObj) {
                            highlightWord(wordObj);
                        }
                    }
                });
            }

            // Проверка слова при полном вводе
            function checkWordOnComplete(inputElement) {
                const wordId = inputElement.data('word');
                const wordObj = words.find(w =>
                    `${w.direction}-${words.indexOf(w) + 1}` === wordId
                );

                if (wordObj) {
                    // Проверяем, заполнены ли все буквы слова
                    const wordCells = $(`input[data-word="${wordId}"]`);
                    let allFilled = true;

                    wordCells.each(function() {
                        if (!$(this).val()) {
                            allFilled = false;
                            return false; // break the loop
                        }
                    });

                    if (allFilled) {
                        checkWord(wordObj);
                    } else {
                        // Снимаем подсветку, если слово не полностью заполнено
                        wordCells.removeClass('correct incorrect');
                        $(`.clue[data-word="${wordId}"]`).removeClass('word-correct word-incorrect');
                    }
                }
            }

            // Функция подсветки слова
            function highlightWord(wordObj) {
                const { word, row, col, direction } = wordObj;
                const wordLength = word.length;
                const wordNum = words.indexOf(wordObj) + 1;
                const wordId = `${direction}-${wordNum}`;

                // Снимаем подсветку
                $('.cell').removeClass('active-cell');
                $('.clue').removeClass('active-clue');

                // Подсвечиваем ячейки
                for (let i = 0; i < wordLength; i++) {
                    const currentRow = direction === "down" ? row + i - 1 : row - 1;
                    const currentCol = direction === "across" ? col + i - 1 : col - 1;

                    currentCrossword.grid[currentRow][currentCol].element.addClass('active-cell');
                }

                // Подсвечиваем подсказку
                $(`.clue[data-word="${wordId}"]`).addClass('active-clue');
            }

            // Функция получения следующей ячейки
            function getNextCell(row, col, direction) {
                let nextRow = row;
                let nextCol = col;

                if (direction === "across") {
                    nextCol += 1;
                } else {
                    nextRow += 1;
                }

                if (nextRow >= 0 && nextRow < 20 && nextCol >= 0 && nextCol < 20) {
                    const nextCellData = currentCrossword.grid[nextRow][nextCol];
                    if (!nextCellData.isBlack && nextCellData.element.children('input').length) {
                        return nextCellData.element.children('input');
                    }
                }
                return null;
            }

            // Проверка одного слова
            function checkWord(wordObj) {
                const { word, row, col, direction } = wordObj;
                const wordLength = word.length;
                const wordNum = words.indexOf(wordObj) + 1;
                const wordId = `${direction}-${wordNum}`;
                let isCorrect = true;

                // Проверяем каждую букву
                for (let i = 0; i < wordLength; i++) {
                    const currentRow = direction === "down" ? row + i - 1 : row - 1;
                    const currentCol = direction === "across" ? col + i - 1 : col - 1;

                    const cellData = currentCrossword.grid[currentRow][currentCol];
                    const input = cellData.element.children('input');
                    const userChar = input.val().toUpperCase();
                    const correctChar = word[i];

                    if (userChar !== correctChar) {
                        isCorrect = false;
                        break;
                    }
                }

                // Подсвечиваем слово в зависимости от результата проверки
                const wordCells = $(`input[data-word="${wordId}"]`);
                const clueElement = $(`.clue[data-word="${wordId}"]`);

                if (isCorrect) {
                    wordCells.addClass('correct').removeClass('incorrect');
                    clueElement.addClass('word-correct').removeClass('word-incorrect');

                    // Проверяем, все ли слова решены
                    checkAllWordsSolved();
                } else {
                    wordCells.addClass('incorrect').removeClass('correct');
                    clueElement.addClass('word-incorrect').removeClass('word-correct');
                }

                return isCorrect;
            }

            // Проверка, все ли слова решены
            function checkAllWordsSolved() {
                let allSolved = true;

                words.forEach(wordObj => {
                    const wordNum = words.indexOf(wordObj) + 1;
                    const wordId = `${wordObj.direction}-${wordNum}`;
                    const wordCells = $(`input[data-word="${wordId}"]`);

                    let wordCorrect = true;
                    wordCells.each(function() {
                        if (!$(this).hasClass('correct')) {
                            wordCorrect = false;
                            return false; // break the loop
                        }
                    });

                    if (!wordCorrect) {
                        allSolved = false;
                    }
                });

                if (allSolved) {
                    setTimeout(() => {
                        alert('Поздравляем! Вы успешно решили сканворд!');
                        clearInterval(timerInterval);
                    }, 300);
                }
            }

            // Кнопка показа ответа
            $('#reveal-btn').click(function() {
                const activeClue = $('.active-clue');
                if (activeClue.length) {
                    const wordId = activeClue.data('word');
                    const wordObj = words.find(w =>
                        `${w.direction}-${words.indexOf(w) + 1}` === wordId
                    );

                    if (wordObj) {
                        revealWord(wordObj);
                    }
                } else {
                    alert('Выберите слово для раскрытия (кликните на подсказку или ячейку)');
                }
            });

            // Раскрытие одного слова
            function revealWord(wordObj) {
                const { word, row, col, direction } = wordObj;
                const wordLength = word.length;
                const wordNum = words.indexOf(wordObj) + 1;
                const wordId = `${direction}-${wordNum}`;

                for (let i = 0; i < wordLength; i++) {
                    const currentRow = direction === "down" ? row + i - 1 : row - 1;
                    const currentCol = direction === "across" ? col + i - 1 : col - 1;

                    const cellData = currentCrossword.grid[currentRow][currentCol];
                    const input = cellData.element.children('input');

                    input.val(word[i])
                        .addClass('correct')
                        .removeClass('incorrect');
                }

                // Подсвечиваем подсказку как правильную
                $(`.clue[data-word="${wordId}"]`).addClass('word-correct').removeClass('word-incorrect');

                // Проверяем, все ли слова решены
                checkAllWordsSolved();
            }

            // Новая игра
            $('#new-game-btn').click(function() {
                if (confirm('Начать новую игру? Текущий прогресс будет потерян.')) {
                    generateCrossword();
                    startTimer();
                }
            });
        });
    </script>
</body>
</html>